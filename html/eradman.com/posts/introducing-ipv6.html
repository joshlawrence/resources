<!DOCTYPE html>
<html>
  <head>
    <title>
      Introducing IPv6
    </title>
    <meta content='text/html; charset=US-ASCII' http-equiv='Content-Type'>
    <link href='../main.css' rel='stylesheet' type='text/css'>
    <link href='../code.css' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <h3 style='margin-left: 5px; margin-top: 20px;'>
      <a href='../index.html' id='myname'>Eric Radman</a>
      <span id='mytitle'>: a Journal</span>
    </h3>
    <div id='article'>
      <h1>Introducing IPv6</h1>
      <h2>Trial Configuration - Server</h2>
      <p>
        If your provider doesn't have native IPv6 support you can use a tunnel broker
        such as <a href="http://sixxs.net/">sixxs.net</a>.  Add the tunnel configuration
        to <em>/etc/hostname.gif0</em>.
      </p>
      <pre>&#x000A;mtu 1280&#x000A;tunnel 65.49.80.28 216.14.98.22&#x000A;inet6 2001:4978:f:18::2 128&#x000A;dest 2001:4978:f:18::1&#x000A;!/sbin/route add -inet6 default ::1&#x000A;!/sbin/route change -inet6 default -ifp gif0&#x000A;</pre>
      <p>
        If you want to respond to reverse delegations, then you have to use an
        address from the /64 subnet supplied by the tunnel broker. I added the IPv6
        address to <em>hostname.vic0</em>, but any interface would work.
      </p>
      <pre>&#x000A;inet 65.49.80.28 255.255.255.192&#x000A;inet6 2001:4978:f:8018::1/64&#x000A;</pre>
      <h2>
        Services - HTTP
      </h2>
      <pre>&#x000A;<span class="Statement">http</span><span class="Normal"> {</span>&#x000A;<span class="Normal">    </span><span class="Statement">server</span><span class="Normal"> {</span>&#x000A;        <span class="Type">listen</span> [::]:80;&#x000A;        <span class="Type">listen</span> *:80;&#x000A;    }&#x000A;}&#x000A;</pre>
      <h2>Services - DNS</h2>
      <h3>
        Secondary Nameservers
      </h3>
      <pre>&#x000A;<span class="Comment">#/var/named/etc/named.conf</span>&#x000A;<span class="Statement">options</span> {&#x000A;    <span class="Statement">allow-transfer</span> {&#x000A;                <span class="Comment"># transfer.buddyns.com</span>&#x000A;        2607:f0d0:1005:72::100;&#x000A;        2a01:4f8:d12:d01::10:100;&#x000A;    };&#x000A;<span class="Error">}</span>&#x000A;&#x000A;</pre>
      <h3>
        Reverse Zones
      </h3>
      <pre>&#x000A;<span class="Statement">zone</span> <span class="Error">&quot;8.1.0.8.f.0.0.0.8.7.9.4.1.0.0.2.ip6.arpa&quot;</span> <span class="Error">{</span>&#x000A;        <span class="Error">type</span> <span class="Error">master;</span>&#x000A;        <span class="Error">file</span> <span class="Error">&quot;master/8.1.0.8.f.0.0.0.8.7.9.4.1.0.0.2.ip6.arpa&quot;;</span>&#x000A;<span class="Error">};</span>&#x000A;&#x000A;<span class="PreProc">$ORIGIN </span><span class="Statement">8.1.0.8.f.0.0.0.8.7.9.4.1.0.0.2.ip6.arpa.</span>&#x000A;<span class="PreProc">$TTL </span><span class="Constant">6h</span>&#x000A;&#x000A;<span class="Special">@ </span>      <span class="PreProc">IN</span>      <span class="Type">SOA</span>     <span class="Identifier">localhost.</span> <span class="Identifier">root.localhost.</span> (&#x000A;                        <span class="Constant">2</span>       <span class="Comment">; serial</span>&#x000A;                        <span class="Constant">1h</span>      <span class="Comment">; refresh</span>&#x000A;                        <span class="Constant">30m</span>     <span class="Comment">; retry</span>&#x000A;                        <span class="Constant">7d</span>      <span class="Comment">; expiration</span>&#x000A;                        <span class="Constant">1h</span> )    <span class="Comment">; minimum</span>&#x000A;&#x000A;                <span class="Type">NS</span>      <span class="Identifier">vm.eradman.com.</span>&#x000A;&#x000A;<span class="Statement">1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0</span> <span class="Type">PTR</span> <span class="Identifier">vm.eradman.com.</span>&#x000A;&#x000A;</pre>
      <p>
        First, there isn't 128 bits of routable address space. Without NAT every end
        user needs a /48.
      </p>
      <pre>&#x000A;# /etc/hostname.dc0&#x000A;inet 192.168.0.1/24&#x000A;inet6 2001:470:a020::1/48&#x000A;</pre>
      <p>
        Why? A subnet cannot be smaller than a /64 without breaking neighbor
        discovery, stateless autoconfiguration, and so on. Therefore every end site
        needs a /56 or /48.
      </p>
      <pre>&#x000A;# /etc/hostname.hme0&#x000A;# My LAN&#x000A;inet 192.168.0.1/24&#x000A;inet6 2001:470:a020:1::1/64&#x000A;</pre>
      <pre>&#x000A;# /etc/hostname.hme1&#x000A;# Guest wireless&#x000A;inet 192.168.1.1/24&#x000A;inet6 2001:470:a020:2::1/64&#x000A;</pre>
      <h2>IPv6 is 45 bits</h2>
      <p>
        It turns out that you can't use the first 3 bits either, the format prefix is
        functionally used as a protocol ID, only 2001:: is world-routable.</p>
      </p>
      <pre>&#x000A;$ ping6 -S fe80::216:cfff:fe43:4d09 ipv6.eradman.com&#x000A;ping6: bind: Can't assign requested address&#x000A;&#x000A;</pre>
      <p>
        It's interesting to note that with private IP addresses there's no confusion
        about what consitutes a valid source address
      </p>
      <pre>&#x000A;$ ping -S 192.168.0.4 eradman.com&#x000A;PING eradman.com (65.49.80.28): 56 data bytes&#x000A;64 bytes from 65.49.80.28: icmp_seq=0 ttl=242 time=101.431 ms&#x000A;64 bytes from 65.49.80.28: icmp_seq=1 ttl=242 time=97.135 ms&#x000A;&#x000A;</pre>
      <h2>Stale Routes</h2>
      <p>
        If you move from one network to another you may discover that you
      </p>
      <em>
        dhclient</em> has renewed your IP address, but left stale IPv6 addresses in
        place. To solve this manually flush out the IPv6 routes
      </em>
      <pre>&#x000A;$ doas route -n flush -inet6&#x000A;</pre>
      <p>
        And then zero out each interface
      </p>
      <pre>&#x000A;$ doas ifconfig wpi0 -inet6&#x000A;$ doas ifconfig em0 -inet6&#x000A;</pre>
      <h2>References</h2>
      <p>
        <a href="../library/is_the_ipv6_address_space_too_small_.pdf">Why IPv6 Address Space is Too Small</a>
      </p>
    </div>
    <p class='timestamp'>
      Last updated on October 20, 2016
    </p>
  </body>
</html>
