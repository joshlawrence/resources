<!DOCTYPE html>
<html>
  <head>
    <title>
      Multiple ISO-8859 Encodings in Lout
    </title>
    <meta content='text/html; charset=US-ASCII' http-equiv='Content-Type'>
    <link href='../main.css' rel='stylesheet' type='text/css'>
    <link href='../code.css' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <h3 style='margin-left: 5px; margin-top: 20px;'>
      <a href='../index.html' id='myname'>Eric Radman</a>
      <span id='mytitle'>: a Journal</span>
    </h3>
    <div id='article'>
      <h1>Multiple ISO-8859 Encodings in Lout</h1>
      <p>
        Before you start, keep in mind the following:
      </p>
      <ol>
        <li>
          X11, Lout, GhostScript, and PSUtils all look for Type1 fonts in different
          locations and use unrelated configureation.
        </li>
        <li>
          You need the <em>.pfa</em> (font outlines) and <em>.afm</em> (font
          metrics). FontForge can save the metrics file when you generate the fonts.
        </li>
        <li>
          The 8-bit encodings are intended only for modern dialects, and do not have
          native support for combined characters, ancient accents and other notations.
        </li>
        <li>
          If you want to distribute a postscript document with new fonts, every page
          must have them embedded with <em>includeres</em>.
        </li>
        <li>
          Don't use <em>@Font</em> adjustments in the body of the document directly,
          wrap it with a macro so it can be easily tweaked and read.
        </li>
      </ol>
      <h2>Latin, Greek and Hebrew</h2>
      <p>
        Most fonts distributed today are Unicode fonts. Lout only uses 8-bit
        character sets, but it is still possible to include languages that use multiple
        encodings in the same source.
      </p>
      <p>
        Efraim Yawitz <a
        href="http://lists.planix.com/pipermail/lout-users/attachments/20010207/f5ccb314/heblout.tar.obj">posted</a>
        some macros and the David font that are very useful for this, including new
        macros <em>@RLFill</em> and <em>LRFill</em>. Put these macros in a file called
        <em>mydefs</em> in your working directory and it will work fine for simple
        functions. There are a lot of extra glyphs in the David typeface that exclude
        the Latin character set, so use care if you choose to use them in Lout--you are
        essentially creating an ad-hoc encoding. In these examples I don't use
        right-to-left editing, I typed them in display order.
      </p>
      <p class='center'>
        <img src="../library/hebrew-lout/hebrew8.png" alt="David font glyps" width="551" height="508" />
      </p>
      <p>
        The simplified Greek font that I use are the Type 1 scalable Greek (ISO
        8859-7) distributed by <a
        href="ftp://ftp.redhat.com/pub/redhat/linux/7.3/en/os/i386/SRPMS/fonts-ISO8859-7-1.0-2.src.rpm">Red
        Hat</a>. Lout and GhostScript will die when using fonts that aren't encoded in
        a specific way, so use <a
        href="http://fontforge.sourceforge.net/">FontForge</a> to re-encode them with
        the specific ISO-8859- character set.
        <p class="center"><img src="../library/hebrew-lout/greek8.png" alt="Greek Times
        glyphs" width="551" height="411" />
      </p>
      <h2>Building and Previewing</h2>
      <p>
        Makefiles make managing compiled source much easier, and text processing is
        no exception. Start by defining some paths specific to your system:
      </p>
      <pre>&#x000A;<span class="Identifier">GS_FONTS</span>=/usr/local/share/ghostscript/fonts&#x000A;<span class="Identifier">PS_UTILS</span>=/usr/local/share/psutils&#x000A;<span class="Identifier">WD</span>=<span class="Identifier">`pwd`</span>&#x000A;</pre>
      <p>
        Make sure Lout knows that there are fonts in the current directory with
        <em>-F</em> so it doesn't complain.
      </p>
      <pre>&#x000A;<span class="Identifier">all:</span> mixed-8859.ps&#x000A;        lout -F <span class="Identifier">${WD}</span> mixed-8859 &gt; mixed-8859.ps&#x000A;&#x000A;<span class="Identifier">pre:</span> mixed-8859.ps&#x000A;        gv mixed-8859.ps&#x000A;&#x000A;<span class="Identifier">mixed-8859.ps:</span>&#x000A;<span class="Error">        lout -F ${WD} mixed-8859 &gt; mixed-8859.ps</span>&#x000A;</pre>
      <p>
        Before you can distribute a document with unusual fonts you must embed them
        with the utility <em>includeres</em>. This makes the file size huge, but as
        Valeriy E. Ushakov <a
        href="http://snark.ptc.spbu.ru/~uwe/lout/essays/1365.fonts.txt">explains</a>,
        page independence dictates that each page is not dependent on definitions in
        previous pages.
      </p>
      <p>
        Instead of copying the fonts to multiple places, I use a symbolic link from
        GhostScript's font directory to PSUtils.
      </p>
      <pre>&#x000A;<span class="Identifier">install:</span>&#x000A;<span class="Error">        cp davidy.afm davidy.pfa ${GS_FONTS}</span>&#x000A;        ln -fs <span class="Identifier">${GS_FONTS}</span>/davidy.pfa <span class="Identifier">${PS_UTILS}</span>/David&#x000A;        cp grktimp.afm grktimp.pfa <span class="Identifier">${GS_FONTS}</span>&#x000A;        ln -fs <span class="Identifier">${GS_FONTS}</span>/grktimp.pfa <span class="Identifier">${PS_UTILS}</span>/Greek-TimesPlain&#x000A;&#x000A;<span class="Identifier">uninstall:</span>&#x000A;<span class="Error">        rm ${PS_UTILS}/David</span>&#x000A;        rm <span class="Identifier">${GS_FONTS}</span>/davidy.pfa <span class="Identifier">${GS_FONTS}</span>/davidy.afm&#x000A;        rm <span class="Identifier">${PS_UTILS}</span>/Greek-TimesPlain&#x000A;        rm <span class="Identifier">${GS_FONTS}</span>/grktimp.pfa <span class="Identifier">${GS_FONTS}</span>/grktimp.afm&#x000A;&#x000A;<span class="Identifier">final:</span>&#x000A;<span class="Error">        includeres mixed-8859.ps  &gt; output.ps</span>&#x000A;</pre>
      <p>
        And make sure to clean up anything you don't want.
      </p>
      <pre>&#x000A;<span class="Identifier">clean:</span>&#x000A;<span class="Error">        rm -f mixed-8859.ps *.li *.ldx *.lix mixed-8859.ld output.ps XftCache fonts.*</span>&#x000A;</pre>
      <p>
        Finally, create a file called <em>Fontmap</em> and put in the definitions
        for which <em>gs</em> and related utilities can read to find out what a font
        name means.
      </p>
      <pre>&#x000A;/DaviD  (davidy.pfa);&#x000A;/Greek-TimesPlain  (grktimp.pfa);&#x000A;</pre>
      <h2>Telling Lout about New Fonts</h2>
      <p>
        Instead of putting font definitions in <em>mydefs</em>, I create a new
        library with the Lout <em>FontDef</em> statements in it called
        <em>custom.fd.ld:</em>
      </p>
      <pre>&#x000A;<span class="Special">{</span><span class="Identifier">@FontDef</span>&#x000A;        <span class="Special">@Tag {David-Base}</span>&#x000A;        <span class="Identifier">@Face</span> <span class="Special">{</span>Base<span class="Special">}</span>&#x000A;        <span class="Identifier">@Family</span> <span class="Special">{</span>David<span class="Special">}</span>&#x000A;        <span class="Identifier">@Name</span> <span class="Special">{</span>David<span class="Special">}</span>&#x000A;        <span class="Identifier">@Metrics</span> <span class="Special">{</span>davidy.afm<span class="Special">}</span>&#x000A;        <span class="Identifier">@Mapping</span> <span class="Special">{</span>Latin1.LCM<span class="Special">}</span>&#x000A;<span class="Special">}</span>&#x000A;<span class="Special">{</span><span class="Identifier">@FontDef</span>&#x000A;        <span class="Special">@Tag {Greek-Base}</span>&#x000A;        <span class="Identifier">@Face</span> <span class="Special">{</span>Base<span class="Special">}</span>&#x000A;        <span class="Identifier">@Family</span> <span class="Special">{</span>Greek<span class="Special">}</span>&#x000A;        <span class="Identifier">@Name</span> <span class="Special">{</span>Greek-TimesPlain<span class="Special">}</span>&#x000A;        <span class="Identifier">@Metrics</span> <span class="Special">{</span>grktimp.afm<span class="Special">}</span>&#x000A;        <span class="Identifier">@Mapping</span> <span class="Special">{</span>Latin1.LCM<span class="Special">}</span>&#x000A;<span class="Special">}</span>&#x000A;&#x000A;</pre>
      <p>
        Notice how these parameters match the labels in the font metrics files:
      </p>
      <pre>&#x000A;$ grep Name *.afm&#x000A;davidy.afm:FontName David&#x000A;davidy.afm:FullName David&#x000A;davidy.afm:FamilyName David&#x000A;grktimp.afm:FontName Greek-TimesPlain&#x000A;grktimp.afm:FullName Greek Times Plain&#x000A;grktimp.afm:FamilyName Greek Times&#x000A;</pre>
      <p>
        Now at the end of <em>mydoc</em> (or whatever your custom document parameter
        file is), included a reference to it:
      </p>
      <pre>&#x000A;<span class="Identifier">@Database</span> <span class="Identifier">@FontDef</span> <span class="Special">{</span> custom.fd <span class="Special">}</span>&#x000A;&#x000A;</pre>
      <p>
        A few basic macros make the interjection of these new languages very smooth.
        Here I used <em>@H</em> and <em>@G</em> to change fonts, and <em>@N</em> to put
        in margin notes.
      </p>
      <pre>&#x000A;<span class="PreProc">@Include{mydoc}</span>&#x000A;<span class="PreProc">macro</span> <span class="Identifier">@H</span><span class="Special">{{</span>David Base +1p<span class="Special">}</span> <span class="Identifier">@Font</span><span class="Special">}</span>&#x000A;<span class="PreProc">macro</span> <span class="Identifier">@G</span><span class="Special">{{</span>Greek Base +1p<span class="Special">}</span> <span class="Identifier">@Font</span><span class="Special">}</span>&#x000A;<span class="PreProc">macro</span> <span class="Identifier">@N</span><span class="Special">{</span><span class="loutItalic">@I @OuterNote</span><span class="Special">}</span>&#x000A;<span class="Statement">@Doc</span>&#x000A;<span class="Identifier">@Text</span><span class="Special">{</span>&#x000A;&#x000A;<span class="Special">}</span>&#x000A;&#x000A;</pre>
      <p>
        The output presented in <em>gv</em> is very sharp.  This screen-shot is of
        X.org 7.2 with <em>hintingstyle</em> set to <em>hintfull</em> in
        <em>~/.fonts.conf</em>.
        <p class="center"><img src="../library/hebrew-lout/typeset-page.png" alt="Typeset Page" width="549" height="227" />
      </p>
      <h2>Encodings in VIM</h2>
      <p>
        Sometimes it's helpful to set up some shortcuts for changing encoding.
      </p>
      <pre>&#x000A;<span class="vimCommand">map</span> _u :set encoding=utf-8&#x000A;<span class="vimCommand">map</span> _1 :set encoding=iso-8859-1&#x000A;<span class="vimCommand">map</span> _7 :set encoding=iso-8859-7&#x000A;<span class="vimCommand">map</span> _8 :set encoding=iso-8859-8&#x000A;</pre>
      <p>
        Once you have the right terminal emulation and encoding use the
        <em>:digraphs</em> command to see the available characters and the keystrokes
        for producing them. <em>Ctrl+K</em> will enable you to type any one of these
        sequences without a special keyboard map.
        <p class="center"><img src="../library/hebrew-lout/8859-8-digraphs.png"
        alt="ISO-8859-8 digraphs in VIM" width="734" height="374" />
      </p>
      <h2>Changing Terminal Fonts</h2>
      <p>
        The easiest way to switch fonts is with <em>mlterm</em>, then define some
        keyboard shortcuts in <em>.mlterm/key</em>.
      </p>
      <pre>&#x000A;Control+F1=&quot;proto:encoding=iso8859-1&quot;&#x000A;Control+F7=&quot;proto:encoding=iso8859-7&quot;&#x000A;Control+F8=&quot;proto:encoding=iso8859-8&quot;&#x000A;Control+F12=&quot;proto:encoding=utf-8&quot;&#x000A;</pre>
      <p>
        Setting the encoding in VIM gives easy access to the digigraph table, but
        the current font will determine how the characters look. <em>mlterm</em> will
        default to Latin1.
      </p>
      <p class='center'>
        <img src="../library/hebrew-lout/editor-latin1.png" alt="vim running in mlterm" width="734" height="374" />
      </p>
    </div>
    <p class='timestamp'>
      Last updated on November 26, 2016
    </p>
  </body>
</html>
